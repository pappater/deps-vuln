(this["webpackJsonpaudit-report-ui"]=this["webpackJsonpaudit-report-ui"]||[]).push([[0],{10:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(4),i=n.n(a),s=n(0);var c=e=>{let{onFileDrop:t}=e;const[n,o]=Object(r.useState)(!1),[a,i]=Object(r.useState)(""),c=e=>(e.preventDefault(),e.stopPropagation(),!1);return Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{onDragEnter:e=>{c(e),o(!0)},onDragOver:e=>{c(e),o(!0)},onDragLeave:e=>{c(e),o(!1)},onDrop:async e=>{c(e),o(!1);const n=e.dataTransfer.files;if(n.length>0){let e=null,o=null,a="",s="";for(let t=0;t<n.length;t++){const i=n[t];let c="";try{c=await i.text()}catch(r){console.error("Error reading file ".concat(i.name,":"),r);continue}try{const t=JSON.parse(c);t.vulnerabilities||t.advisories?(e=t,a=i.name):t.dependencies&&(o=t,s=i.name)}catch(r){console.error("Error parsing JSON in file ".concat(i.name,":"),r)}}if(console.log("Detected files:",{auditFileName:a,lsFileName:s}),console.log("auditJson:",e),console.log("lsJson:",o),e&&o){i("");try{const n=await async function(e,t){const n=Array.from(function(e){const t=new Set;e.advisories&&"object"===typeof e.advisories&&Object.values(e.advisories).forEach(e=>{e.module_name&&t.add(e.module_name)});e.vulnerabilities&&"object"===typeof e.vulnerabilities&&Object.keys(e.vulnerabilities).forEach(e=>t.add(e));Array.isArray(e)&&e.length>0&&e.forEach(e=>{e.module_name&&t.add(e.module_name),e.package&&t.add(e.package)});return t}(e));if(console.log("Vulnerable packages extracted:",n),0===n.length)return console.warn("No vulnerable packages found in auditJson."),[];const r=new Set(n),o=function(e){const t={};e.advisories&&"object"===typeof e.advisories&&Object.values(e.advisories).forEach(e=>{e.module_name&&(t[e.module_name]={severity:e.severity||"",url:e.url||(e.cves&&e.cves.length?e.cves[0]:"")})});e.vulnerabilities&&"object"===typeof e.vulnerabilities&&Object.entries(e.vulnerabilities).forEach(e=>{let[n,r]=e,o="";if(r.via&&Array.isArray(r.via)&&r.via.length>0){const e=r.via.find(e=>"object"===typeof e&&e.url);e&&(o=e.url)}t[n]={severity:r.severity||"",url:o}});return t}(e),a=function(e,t,n){const r=[],o=new Set;function a(e,i){if(e&&e.dependencies)for(const[s,c]of Object.entries(e.dependencies)){if(!t.has(s)){a(c,[...i,s]);continue}const e=[...i,s],l=e.slice(1).join(" -> "),d="".concat(s,"@").concat(c.version||"");if(!o.has(d)){o.add(d);const e=n[s]||{};r.push({package:s,version:c.version||"",parentChain:l,severity:e.severity||"",url:e.url||""})}a(c,e)}}return a(e,[e.name||"root"]),r}(t,r,o);console.log("Parent chains found:",a);const i=new Set,s=[];for(const c of a){const e="".concat(c.package,"@").concat(c.version);i.has(e)||(i.add(e),s.push(c))}return s}(e,o);console.log("Extracted vulnerable table data:",n),0===n.length?i("No vulnerable packages found in the provided files."):i(""),t(n)}catch(r){console.error("Error processing vulnerability data:",r),i("Error processing vulnerability data. See console for details."),t([])}}else{let n="";e||o?e?o||(n="Missing npm-ls.json. Detected: ".concat(a||"none")):n="Missing npm-audit.json. Detected: ".concat(s||"none"):n="Neither npm-audit.json nor npm-ls.json detected. Please drop both files.",i(n),t([])}}},onClick:e=>e.preventDefault(),tabIndex:0,style:{border:n?"2px dashed #111":"2px solid #bbb",background:n?"#eee":"#fff",color:"#111",borderRadius:16,padding:"24px",textAlign:"center",fontSize:18,fontWeight:600,outline:"none",transition:"border 0.2s, background 0.2s",marginBottom:8,width:420,maxWidth:"100%",marginLeft:"auto",marginRight:"auto"},children:n?"Release to drop the files":"Drag and drop your npm-audit.json and npm-ls.json files here"}),a&&Object(s.jsx)("div",{style:{color:"#c00",marginTop:10},children:a})]})};const l=["package","version","parentChain","severity","url"],d={package:"Vulnerable Package",version:"Current Version",parentChain:"Parent Chain",severity:"Severity",url:"Advisory URL"};var p=e=>{let{data:t}=e;if(!t||0===t.length)return Object(s.jsx)("div",{style:{marginTop:20,color:"#888"},children:"No data available"});const n=l.filter(e=>t.some(t=>void 0!==t[e]));return Object(s.jsx)("div",{style:{overflowX:"auto",marginTop:20},children:Object(s.jsxs)("table",{style:{borderCollapse:"collapse",width:"100%",background:"#fff",borderRadius:8,boxShadow:"0 2px 8px #0001"},children:[Object(s.jsx)("thead",{children:Object(s.jsx)("tr",{style:{background:"#222",color:"#fff"},children:n.map(e=>Object(s.jsx)("th",{style:{padding:"8px 12px",border:"1px solid #ddd"},children:d[e]||e},e))})}),Object(s.jsx)("tbody",{children:t.map((e,t)=>Object(s.jsx)("tr",{style:{background:t%2===0?"#f9f9f9":"#fff"},children:n.map(t=>Object(s.jsx)("td",{style:{padding:"8px 12px",border:"1px solid #eee",wordBreak:"break-all"},children:"url"===t&&e[t]?Object(s.jsx)("a",{href:e[t],target:"_blank",rel:"noopener noreferrer",children:"Advisory"}):e[t]},t))},t))})]})})};var u=e=>{let{data:t}=e;return Object(s.jsx)("button",{className:"button",onClick:()=>{if(!t||0===t.length)return;const e=Object.keys(t[0]),n=[e.join(",")];for(const s of t)n.push(e.map(e=>{var t;return'"'.concat(String(null!==(t=s[e])&&void 0!==t?t:"").replace(/"/g,'""'),'"')}).join(","));const r=n.join("\n"),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),i=document.createElement("a");i.setAttribute("href",a),i.setAttribute("download","audit_report.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},children:"Export as CSV"})};function b(e){return e.split(" -> ")[1]||e.split(" -> ")[0]||""}function f(e){const t={};for(const n of e){const e=b(n.parentChain);e&&(t[e]||(t[e]=new Set),t[e].add(n.package))}return Object.entries(t).map(e=>{let[t,n]=e;return{parent:t,packages:Array.from(n)}})}n(3);const h=e=>{let{sections:t}=e;const[n,r]=o.a.useState(0);return Object(s.jsx)("div",{style:{margin:"24px 0",maxWidth:900,width:"100%"},children:t.map((e,t)=>Object(s.jsxs)("div",{style:{marginBottom:12,borderRadius:8,border:"1px solid #bbb",background:"#fff",boxShadow:"0 2px 8px #0001"},children:[Object(s.jsxs)("div",{style:{cursor:"pointer",padding:"14px 20px",fontWeight:700,background:n===t?"#eaeaeaff":"#e6e6e6ff",borderRadius:"8px 8px 0 0",borderBottom:n===t?"1px solid #bbb":"none",fontSize:18,transition:"background 0.2s"},onClick:()=>r(n===t?null:t),children:[e.title,Object(s.jsx)("span",{style:{float:"right",fontWeight:400,fontSize:20},children:n===t?"\u25b2":"\u25bc"})]}),n===t&&Object(s.jsx)("div",{style:{padding:"18px 24px",background:"#f9f9f9",borderRadius:"0 0 8px 8px",fontSize:16,maxHeight:350,overflowY:"auto"},children:e.content})]},e.title))})},j=e=>{let{items:t}=e;const[n,r]=o.a.useState(null);return t.length?Object(s.jsx)("div",{style:{marginTop:10},children:t.map((e,t)=>Object(s.jsxs)("div",{style:{marginBottom:8,borderRadius:0,border:"1px solid #bbb",background:"#fff"},children:[Object(s.jsxs)("div",{style:{cursor:"pointer",padding:"10px 14px",fontWeight:600,background:n===t?"#eee":"#fff",color:"#111",borderRadius:"0",borderBottom:n===t?"1px solid #bbb":"none",transition:"background 0.2s"},onClick:()=>r(n===t?null:t),children:[e.parent,Object(s.jsx)("span",{style:{float:"right",fontWeight:400,fontSize:18},children:n===t?"\u25b2":"\u25bc"})]}),n===t&&Object(s.jsxs)("div",{style:{padding:"10px 18px",background:"#fff",borderRadius:"0",fontSize:15,color:"#111"},children:[Object(s.jsx)("div",{children:Object(s.jsx)("b",{children:"Affected packages:"})}),Object(s.jsx)("ul",{style:{margin:"8px 0 0 18px",padding:0},children:e.packages.map(e=>Object(s.jsx)("li",{style:{marginBottom:2},children:e},e))}),Object(s.jsxs)("div",{style:{marginTop:8,color:"#111"},children:[Object(s.jsx)("b",{children:"Recommendation:"})," Upgrade ",Object(s.jsx)("b",{children:e.parent})," to the latest safe version."]})]})]},e.parent))}):Object(s.jsx)("div",{children:"No actionable parent upgrades detected."})};var g=()=>{const[e,t]=o.a.useState([]),[n,r]=o.a.useState([]),[a,i]=o.a.useState(""),[l,d]=o.a.useState(""),[b,g]=o.a.useState(!1);return o.a.useEffect(()=>{const e=e=>{e.preventDefault(),e.stopPropagation()};return window.addEventListener("dragover",e),window.addEventListener("drop",e),()=>{window.removeEventListener("dragover",e),window.removeEventListener("drop",e)}},[]),Object(s.jsx)("div",{className:"white-theme",children:Object(s.jsxs)("div",{className:"container",style:{maxWidth:950,margin:"0 auto",padding:24},children:[Object(s.jsxs)("header",{style:{textAlign:"left",margin:"32px 0 40px 0"},children:[Object(s.jsx)("h1",{style:{fontFamily:"Inter, system-ui, Arial, sans-serif",fontWeight:900,fontSize:44,letterSpacing:"-1.5px",color:"#111",margin:0},children:"NPM Audit Actionable Insights"}),Object(s.jsx)("div",{style:{fontSize:20,color:"#111",marginTop:10,fontWeight:500},children:"Get clear, minimal upgrade advice for your dependencies"})]}),Object(s.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",marginBottom:36},children:Object(s.jsx)(c,{onFileDrop:e=>{t(e),r(f(e)),i("")}})}),Object(s.jsx)(h,{sections:[{title:"Minimal Upgrade Summary",content:n.length>0?Object(s.jsx)(j,{items:n}):Object(s.jsx)("div",{children:"No data available."})},{title:"LLM-powered Summary (OpenAI)",content:e.length>0?Object(s.jsxs)("div",{children:[Object(s.jsx)("input",{type:"password",placeholder:"Enter OpenAI API Key",value:l,onChange:e=>d(e.target.value),style:{width:260,marginRight:8,padding:4,borderRadius:4,border:"1px solid #ccc"}}),Object(s.jsx)("button",{onClick:async()=>{if(l){g(!0);try{const t=await async function(e,t){var n,r,o,a;const i=f(e),s="Given the following parent libraries and the vulnerable packages they affect, write a concise summary for a developer on which parent libraries to upgrade to fix the vulnerabilities.\n\n".concat(i.map(e=>"Parent: ".concat(e.parent,"\nAffects: ").concat(e.packages.join(", "))).join("\n\n")),c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant for npm dependency vulnerability remediation."},{role:"user",content:s}],max_tokens:200})});return(null===(n=(await c.json()).choices)||void 0===n||null===(r=n[0])||void 0===r||null===(o=r.message)||void 0===o||null===(a=o.content)||void 0===a?void 0:a.trim())||"No summary generated."}(e,l);i(t)}catch(t){i("Error generating LLM summary.")}g(!1)}else i("Please enter your OpenAI API key.")},disabled:b||!l,style:{padding:"12px 28px",borderRadius:0,border:"none",background:"#111",color:"#fff",fontWeight:800,fontSize:18,letterSpacing:"0.5px",cursor:b||!l?"not-allowed":"pointer",opacity:b||!l?.7:1,transition:"background 0.2s, color 0.2s"},children:b?"Generating...":"Generate LLM Summary"}),a&&Object(s.jsx)("div",{style:{marginTop:12,whiteSpace:"pre-line"},children:a})]}):Object(s.jsx)("div",{children:"No data available."})},{title:"Vulnerability Table",content:Object(s.jsxs)("div",{children:[Object(s.jsx)(p,{data:e}),Object(s.jsx)(u,{data:e})]})}]})]})})};i.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(g,{})}),document.getElementById("root"))},3:function(e,t,n){}},[[10,1,2]]]);
//# sourceMappingURL=main.a1c40397.chunk.js.map